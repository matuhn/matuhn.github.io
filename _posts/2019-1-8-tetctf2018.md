---
layout: post
comments: true
title: TetCTF 2019
categories: ['2019']
---
**1/File**

[http://139.180.219.222:8004/](http://139.180.219.222:8004/)

![](https://cdn-images-1.medium.com/max/1650/1*1iY36VD1H3EuUksbcPyEbQ.png)
<span class="figcaption_hack">index.html</span>

·ªû index l√† 1 ƒëo·∫°n chat v·ªÅ ch·ªß ƒë·ªÅ ch√≠nh l√† MacOS hay Windows ngon h∆°n :))), v√†
ng∆∞·ªùi n√≥i MacOS ngon h∆°n l√† anh tsu (author c·ªßa challenge n√†y) n√™n m√¨nh nghƒ© b√†i
n√†y li√™n quan g√¨ ƒë√≥ t·ªõi MacOS

M√¨nh scan th·ª≠ web n√†y c√≥ g√¨ l·∫° k th√¨ scan dc /logs, /icons,‚Ä¶ nh∆∞ng c√°i l√†m m√¨nh
ch√∫ √Ω l√† /.DS_Store (n·∫øu b·∫°n n√†o ch∆∞a bi·∫øt v·ªÅ file n√†y c√≥ th·ªÉ ƒë·ªçc writeup c≈© c·ªßa
m√¨nh v·ªÅ DS_Store
[https://medium.com/@anhkhoafto/35c3ctf-junior-2018-writeups-be9b74ccaa2f](https://medium.com/@anhkhoafto/35c3ctf-junior-2018-writeups-be9b74ccaa2f))

![](https://cdn-images-1.medium.com/max/1650/1*lKUJ8lVsCNqJ7ZfYA-ZoAA.png)

ƒê√¢y l√† to√†n b·ªô source c·ªßa challenge, l·∫•y flag th√¥i

![](https://cdn-images-1.medium.com/max/1650/1*nNECNPS2IejNReRg5yoEVw.png)

> TetCTF{__DS_Store__seems_sad__}

**2/ IQTEST**<br> Tr∆∞·ªõc khi vi·∫øt wu b√†i n√†y th√¨ m√¨nh kh√° bu·ªìn v√† cay v√¨ b√†i n√†y
v√† do m√¨nh ngu + c√πi b·∫Øp n√™n b√†i n√†y t·∫•t c·∫£ l√† c√¥ng c·ªßa
[PeterJson](https://medium.com/@peterjson) t·ª´ g·ª£i √Ω m√¨nh v·ªÅ Hash Length
Extension t·ªõi n√≥i cho m√¨nh hi·ªÉu Hash Length Extension n√≥ ho·∫°t ƒë·ªông ra l√†m sao

Giao di·ªán b√†i n√†y th·∫ø n√†y

![](https://cdn-images-1.medium.com/max/1650/1*5dUoCn0btZwY-j5H4dXD5w.png)

Source Code :

![](https://cdn-images-1.medium.com/max/1650/1*znY4p2Tpp_zTFEUk-XiUCg.png)

![](https://cdn-images-1.medium.com/max/1650/1*Zn2Vfj4qQjQ5FOvdMRAjHg.png)

Cookie:

![](https://cdn-images-1.medium.com/max/1100/1*4fjlGAY0Hu6LSbezy5pucw.png)

![](https://cdn-images-1.medium.com/max/1100/1*XfYLXeAb_yNkEuwthYsdvQ.png)

B√†i n√†y c√≥ 13 c√¢u h·ªèi m√¨nh tr·∫£ l·ªùi ƒë√∫ng 13 c√¢u h·ªèi th√¨ s·∫Ω c√≥ ƒë∆∞·ª£c flag, v·ªõi m·ªói
c√¢u h·ªèi s·∫Ω c√≥ 2 cookie l√† Hash v√† Saved

Saved = b64(seed)

Hash = md5(concat(secrect,seed))

6 c√¢u ƒë·∫ßu th√¨ d·ªÖ d√†ng pass v√¨ l√† c√¢u h·ªèi multiple choice ho·∫∑c l√† m·∫•y c√¢u ƒë∆°n
gi·∫£n, t·ªõi c√¢u th·ª© 7 th√¨ l√† th·∫ø n√†y

![](https://cdn-images-1.medium.com/max/1650/1*RXOmU_td5K-px7SsuhLOZw.png)

C√≥ ƒëo√°n c≈©ng t·ªõi mai :))) n√™n quay tr·ªü l·∫°i source code c·ªßa b√†i n√†y, th√¨ c√≥ 1
ƒëo·∫°n c·∫ßn ch√∫ √Ω

![](https://cdn-images-1.medium.com/max/1100/1*2LqDDwwh3qsxkDc8fxkfIg.png)

N·∫øu level = NULL (kh√¥ng c√≥ 1 cookie n√†o ho·∫∑c cookie kh√¥ng c√≥ nghƒ©a) th√¨ level s·∫Ω
ƒë∆∞·ª£c d·ª±a v√†o ƒëo·∫°n code n√†y, ƒë√¢y l√† ph·∫ßn code m√¨nh debug th·ª≠ ƒë·ªÉ pass t·ªõi level 13

> [https://repl.it/@Bui_Duc_AnhDuc/ShinyNeedyDesktopenvironment](https://repl.it/@Bui_Duc_AnhDuc/ShinyNeedyDesktopenvironment)

V·∫•n ƒë·ªÅ l√† l√†m sao ƒë·ªÉ t·∫°o ra 1 cookie m√† c√≥ md5 hash c√≥ th·ªÉ g·ª≠i l√™n v√† ch·∫°y th·∫≥ng
t·ªõi level 13, ƒë√¢y l√† v·∫•n ƒë·ªÅ c·ªßa Hash Length Extension

C√°c b·∫°n c√≥ th·ªÉ ƒë·ªçc qua 2 wu c·ªßa [PeterJson](https://medium.com/@peterjson) ƒë·ªÉ
hi·ªÉu th√™m v·ªÅ HLE, ho·∫∑c c√≥ th·ªÉ cmt b√™n d∆∞·ªõi m√¨nh c√≥ th·ªÉ gi·∫£i ƒë√°p nh·ªØng c√°i trong
gi·ªõi h·∫°n ki·∫øn th·ª©c m√¨nh h·ªçc ƒë∆∞·ª£c qua ƒë·ªçc 2 wu n√†y:

[https://medium.com/@peterjson/matesctf-round-5-qualification-crypto-writeup-a5e287838e69](https://medium.com/@peterjson/matesctf-round-5-qualification-crypto-writeup-a5e287838e69)
**(ViettelStore ‚Äî Crypto100)**

[https://medium.com/@peterjson/uit-hacking-contest-2018-crypto-writeup-8bf32267e93b](https://medium.com/@peterjson/uit-hacking-contest-2018-crypto-writeup-8bf32267e93b)
**(Crypto400-SuperSecureServer)**

M√¨nh d√πng Hash Extender ƒë·ªÉ gi·∫£i quy·∫øt b√†i n√†y

![](https://cdn-images-1.medium.com/max/1650/1*UXt6CLKFXfu5NDYvs8VDDg.png)

Sau ƒë√≥ m√¨nh d√πng new signature ƒë·ªÉ l√†m cookie hash

new string th√¨ m√¨nh d√πng b64(‚Äòseed=‚Äô+hexdecode(newstring)) ƒë·ªÉ l√†m cookie saved

![](https://cdn-images-1.medium.com/max/1650/1*ntTEUTpWW2FLFPbQNbbrxQ.png)

**3/ phplimit revenge**

![](https://cdn-images-1.medium.com/max/1650/1*i8ItcPPfDV41zunYNLGH3Q.png)

v·ªÅ c√°c filter c·ªßa b√†i n√†y th√¨ m·ªçi ng∆∞·ªùi c√≥ th·ªÉ d√πng
[https://regex101.com/](https://regex101.com/) ƒë·ªÉ ƒë·ªçc hi·ªÉu (ban ƒë·∫ßu kh√° l√† kh√≥
hi·ªÉu nh∆∞ng c√≥ 1 s·ªë tr·ª£ gi√∫p t·ª´ ae b·∫°n d√¨ n√™n m√¨nh c≈©ng hi·ªÉu üò§)

If 1 ch·∫∑n kh√¥ng cho m√¨nh truy·ªÅn argument (string) v√†o c√°c h√†m ƒë·ªÉ ƒë·ªçc flag , n√™n
ch·ªâ c√≥ th·ªÉ truy·ªÅn boolean v√†o ƒë√¢y th√¥i

If 2 th√¨ ch·∫∑n 1 s·ªë h√†m d√πng ƒë·ªÉ ƒë·ªçc flag

[PeterJson](https://medium.com/@peterjson) l·∫°i g·ª£i √Ω m√¨nh 1 h√†m c√≥ th·ªÉ show ra
ƒë∆∞·ª£c path hi·ªán t·∫°i + c√≥ th·ªÉ truy·ªÅn boolean argument v√†o l√† realpath()

![](https://cdn-images-1.medium.com/max/1650/1*6pzag1vRG-Le78Ehw6jyZQ.png)

C·ª• th·ªÉ l√† m√¨nh c√≥ th·ªÉ s·ª≠ d·ª•ng realpath(false) ho·∫∑c realpath(NULL)

m√† NULL th√¨ ƒë√£ c√≥ assert() => v·ªõi realpath(assert()) th√¨ m√¨nh c√≥ ƒë∆∞·ª£c path hi·ªán
t·∫°i

M√¨nh c·∫ßn ƒë·ªçc nh·ªØng file ·ªü path ƒë√≥ th√¨ c√≥ scandir()

![](https://cdn-images-1.medium.com/max/1650/1*NWbG0E4ml-KE2zu28aRG8A.png)

v·ªõi scandir(realpath(assert())) th√¨ m√¨nh c√≥ ƒë∆∞·ª£c to√†n b·ªô nh·ªØng file ·ªü path ƒë√≥

scandir s·∫Ω tr·∫£ v·ªÅ array, m√¨nh ch·ªâ bi·∫øt m·ªói h√†m print_r() ƒë·ªÉ in ra array nh∆∞ng b·ªã
filter m·∫•t :((

![](https://cdn-images-1.medium.com/max/1650/1*N_5m1ZaLzM3LYX_qMSsIWQ.png)

Ok v·∫≠y th√¥i m√¨nh l√†m th·ªß c√¥ng

![](https://cdn-images-1.medium.com/max/1650/1*ln2xzpMxz4rQZOGhzmMCyA.png)

sau 1 h·ªìi m√≤ th√¨ t·ªõi ƒë∆∞·ª£c path n√†y

> [http://139.180.219.222/?code=echo(next(next(scandir(realpath(assert()))));](http://139.180.219.222/?code=echo(next(next(scandir(realpath(assert()))));)

L√† file index, n√™n th√¥i m√¨nh quy·∫øt ƒë·ªãnh coi file cu·ªëi c√πng t√™n g√¨ lu√¥n

> [http://139.180.219.222/?code=echo(end(scandir(realpath(assert()))));](http://139.180.219.222/?code=echo(end(scandir(realpath(assert()))));)

![](https://cdn-images-1.medium.com/max/1650/1*whTN8xiGeIgMG4wCJglS8A.png)

d√πng readfile() ƒë·ªÉ ƒë·ªçc file n√†y

> view-source:[http://139.180.219.222/?code=readfile(end(scandir(realpath(assert()))));](http://139.180.219.222/?code=readfile(end(scandir(realpath(assert()))));)

![](https://cdn-images-1.medium.com/max/1650/1*9jcBoyXtI813TefGlJ99vg.png)

**4/ phplimit revenge v2**

Ph·∫£i n√≥i l√† PHP kh√° l√† ·∫£o di·ªáu khi m√¨nh l√†m ƒëc b√†i n√†y :3 m√¨nh ko hi·ªÉu t√°c gi·∫£
ch·∫∑n strlen r·ªìi rand l√†m g√¨ nh∆∞ng sau 1 th·ªùi gian ƒë·ªçc c√°c h√†m tr√™n w3schools th√¨
th·∫•y c√≥ 4 h√†m l√† `dirname, basename, realpath, pathinfo` th√¨ ƒë·ªÅu b·ªã blacklisted
theo nh∆∞ web n√†y n√≥i

search ƒëi search l·∫°i c≈©ng th·∫•y web n√†o n√≥i l√† d√πng `glob()` k√®m vs pattern

ƒë·∫Øn ƒëo m√£i th√¨ th·ª≠ vs php online th√¨ m√¨nh th·∫•y l√† glob() tr·∫£ v·ªÅ array theo
pattern *, m·ªói ph·∫ßn t·ª≠ l√† c√°c file trong th∆∞ m·ª•c üòÜ

![](https://cdn-images-1.medium.com/max/1100/1*Xnoq-uU3vDDIyvHIfpHfSQ.png)

`'*'` th√¨ n√≥ l√† string, l√†m sao ƒë·ªÉ t·∫°o *? booom, 1 idea kh√° l√† x·ªãn c≈©ng l·∫ßy vc,
l√† t√≠nh ra s·ªë 42 r chr() ƒë·ªÉ th√†nh *

b·∫Øt ƒë·∫ßu ƒëi t·ª´ `exp(assert())` , l√Ω do m√¨nh g·ªçi `assert()` v√¨ n√≥ l√† m·∫∑c ƒë·ªãnh l√†
TRUE == 1, th·ª±c hi·ªán c√°c ph√©p t√≠nh to√°n (l√†m ƒë·∫°i) th√¨ may th·∫≠t ra dc s·ªë 42 üòñ

![](https://cdn-images-1.medium.com/max/1100/1*iDVFcxF0fQ6ojhIQBrq79A.png)

m√¨nh c≈©ng ko hi·ªÉu t·∫°i sao local t√≠nh ra s·ªë kh√°c server t√≠nh s·ªë kh√°c

dc 42 r th√¨ bi·∫øn n√≥ th√†nh * v√† glob :3

![](https://cdn-images-1.medium.com/max/1100/1*e6gAyAFIawcaK6hXbsCgqQ.png)

nh∆∞ tr√™n glob tr·∫£ v·ªÅ array, nh∆∞ng tr∆∞·ªõc ti√™n coi th·ª≠ c√≥ bn file hay folder con
trong folder n√†y (/var/www/html/)

![](https://cdn-images-1.medium.com/max/1100/1*u7l5gw7KAZGfwtynI7RvOA.png)

h√™n vl :))) l√† c√≥ 3 file (ko bi·∫øt c√≥ folder hay ko). Ti·ªán vl, m√¨nh d√πng [c√°c h√†m
n√†y ƒë·ªÉ di chuy·ªÉn con tr·ªè t·ªõi c√°c element trong
array](https://www.w3schools.com/php/func_array_current.asp). H√™n l√† v√¨ t√°c gi·∫£
ƒë·ªÉ ch·ªâ c√≥ 3 file, ch·ª© 4 files m√† flag n·∫±m ·ªü v·ªã tr√≠ th·ª© 3 m√¨nh c≈©ng ch·∫£ bi·∫øt tr·ªè
ki·ªÉu g√¨ =))

ƒëo√°n b·ª´a flag n·∫±m cu·ªëi n√™n m√¨nh d√πng end(‚Ä¶)

![](https://cdn-images-1.medium.com/max/1100/1*goajIB-qLCPVhRoMiCtlXA.png)

Coi th·ª≠ c√≥ c√°i g√¨ trong n√†y

![](https://cdn-images-1.medium.com/max/1100/1*uHpSr8WUFS22UoOCz730FQ.png)

:)))) classic trick t·ª´ a tsu, ok m·ªçi chuy·ªán t·ª´ gi·ªù c√≤n kh√≥ h∆°n

okay, m√¨nh c·∫ßn b√¢y gi·ªù l√† `..` ƒë·ªÉ c√≥ th·ªÉ view c√°c file trong parrent folder

ok, got it, ko d√πng `glob()`n·ªØa m√† m√¨nh s·∫Ω d√πng `scandir('.')`thay cho glob() v√¨
nh∆∞ h√¨nh b√™n tr√™n `glob('*')` ko return v·ªÅ `. ho·∫∑c ..`

![](https://cdn-images-1.medium.com/max/1100/1*eHiLko1bw6m7zK9b1Pq4sQ.png)

Hay qu√° c√≥ r·ªìi :))) b√¢y gi·ªù l√† c√¥ng ƒëo·∫°n l√†m c√°ch n√†o t√≠nh cho ra ƒë∆∞·ª£c s·ªë 46
(decimal c·ªßa .)

B·∫±ng c√°c bi·ªán ph√°p nghi·ªáp v·ª• k·∫øt h·ª£p vs kƒ© nƒÉng to√°n h·ªçc m√† m√¨nh c√≥ v·ªõi 1 √≠t t√¢m
linh n√†o ƒë√≥ ƒë√£ cho m√¨nh s·ª©c m·∫°nh t√≠nh ra dc 64 =))) th·ª≠ xem sao

![](https://cdn-images-1.medium.com/max/1100/1*tCQUMRwJd8goGM0K7MIo-w.png)

c√≥ . r·ªìi th√¨ scandir hi·ªán t·∫°i l√† (.) l·∫•y next() l√† (..), r·ªìi scandir(..), l·∫•y
end l√† c√≥ real flag

![](https://cdn-images-1.medium.com/max/1100/1*812TPBtoFtRbN36owWJkDw.png)

![](https://cdn-images-1.medium.com/max/1100/1*jMoo33DJBg9VljZcJkUSuw.png)

M√† flag c·ªßa m√¨nh ƒë√¢u r·ªìi

Suy nghƒ© 1 ch√∫t th√¨ m√¨nh n√≥ ch·ªâ show content c·ªßa parent dir th√¥i ch·ª© m√¨nh ch∆∞a ·ªü
parent dir

d√πng chdir() th√¨ ch·∫Øc ƒë∆∞·ª£c v√¨ m√¨nh ƒë√£ c√≥ `..` r·ªìi n√™n nh∆∞ng l√†m sao ƒë·ªçc flag?

![](https://cdn-images-1.medium.com/max/1100/1*xDuxfkcofnb3_hs55F6yDA.png)

th·∫ø l·ª±c si√™u nhi√™n n√†o ƒë√≥ l·∫°i gi√∫p m√¨nh khi chdir() return v·ªÅ boolean v√† n√≥ l√†
`true == 1` . Th√¨ sao nh·ªâ :3 nghƒ©a l√† m√¨nh ƒëang c√≥ m·∫∑t ·ªü `..` v√† ch·ªâ c·∫ßn d√πng
ph√©p to√°n m√† th·∫ßn linh ƒë√£ ban cho t√≠nh t·ª´ exp(assert()) == chdir(‚Äò..‚Äô)

![](https://cdn-images-1.medium.com/max/1100/1*5X8ukW4HbaxF7R5gIT8BnA.png)

http://45.76.181.81/?code=readfile(end(scandir(chr(strrev(floor(rad2deg(tan(sin(round(chdir(next(scandir(chr(strrev(floor(rad2deg(tan(sin(round(exp(assert())))))))))))))))))))));
