---
layout: post
comments: true
title: TetCTF 2019
categories: ['2019']
---
**1/File**

[http://139.180.219.222:8004/](http://139.180.219.222:8004/)

![](https://cdn-images-1.medium.com/max/1650/1*1iY36VD1H3EuUksbcPyEbQ.png)
<span class="figcaption_hack">index.html</span>

á» index lÃ  1 Ä‘oáº¡n chat vá» chá»§ Ä‘á» chÃ­nh lÃ  MacOS hay Windows ngon hÆ¡n :))), vÃ 
ngÆ°á»i nÃ³i MacOS ngon hÆ¡n lÃ  anh tsu (author cá»§a challenge nÃ y) nÃªn mÃ¬nh nghÄ© bÃ i
nÃ y liÃªn quan gÃ¬ Ä‘Ã³ tá»›i MacOS

MÃ¬nh scan thá»­ web nÃ y cÃ³ gÃ¬ láº¡ k thÃ¬ scan dc /logs, /icons,â€¦ nhÆ°ng cÃ¡i lÃ m mÃ¬nh
chÃº Ã½ lÃ  /.DS_Store (náº¿u báº¡n nÃ o chÆ°a biáº¿t vá» file nÃ y cÃ³ thá»ƒ Ä‘á»c writeup cÅ© cá»§a
mÃ¬nh vá» DS_Store
[https://medium.com/@anhkhoafto/35c3ctf-junior-2018-writeups-be9b74ccaa2f](https://medium.com/@anhkhoafto/35c3ctf-junior-2018-writeups-be9b74ccaa2f))

![](https://cdn-images-1.medium.com/max/1650/1*lKUJ8lVsCNqJ7ZfYA-ZoAA.png)

ÄÃ¢y lÃ  toÃ n bá»™ source cá»§a challenge, láº¥y flag thÃ´i

![](https://cdn-images-1.medium.com/max/1650/1*nNECNPS2IejNReRg5yoEVw.png)

> TetCTF{__DS_Store__seems_sad__}

**2/ IQTEST**<br> TrÆ°á»›c khi viáº¿t wu bÃ i nÃ y thÃ¬ mÃ¬nh khÃ¡ buá»“n vÃ  cay vÃ¬ bÃ i nÃ y
vÃ  do mÃ¬nh ngu + cÃ¹i báº¯p nÃªn bÃ i nÃ y táº¥t cáº£ lÃ  cÃ´ng cá»§a
[PeterJson](https://medium.com/@peterjson) tá»« gá»£i Ã½ mÃ¬nh vá» Hash Length
Extension tá»›i nÃ³i cho mÃ¬nh hiá»ƒu Hash Length Extension nÃ³ hoáº¡t Ä‘á»™ng ra lÃ m sao

Giao diá»‡n bÃ i nÃ y tháº¿ nÃ y

![](https://cdn-images-1.medium.com/max/1650/1*5dUoCn0btZwY-j5H4dXD5w.png)

Source Code :

![](https://cdn-images-1.medium.com/max/1650/1*znY4p2Tpp_zTFEUk-XiUCg.png)

![](https://cdn-images-1.medium.com/max/1650/1*Zn2Vfj4qQjQ5FOvdMRAjHg.png)

Cookie:

![](https://cdn-images-1.medium.com/max/1100/1*4fjlGAY0Hu6LSbezy5pucw.png)

![](https://cdn-images-1.medium.com/max/1100/1*XfYLXeAb_yNkEuwthYsdvQ.png)

BÃ i nÃ y cÃ³ 13 cÃ¢u há»i mÃ¬nh tráº£ lá»i Ä‘Ãºng 13 cÃ¢u há»i thÃ¬ sáº½ cÃ³ Ä‘Æ°á»£c flag, vá»›i má»—i
cÃ¢u há»i sáº½ cÃ³ 2 cookie lÃ  Hash vÃ  Saved

Saved = b64(seed)

Hash = md5(concat(secrect,seed))

6 cÃ¢u Ä‘áº§u thÃ¬ dá»… dÃ ng pass vÃ¬ lÃ  cÃ¢u há»i multiple choice hoáº·c lÃ  máº¥y cÃ¢u Ä‘Æ¡n
giáº£n, tá»›i cÃ¢u thá»© 7 thÃ¬ lÃ  tháº¿ nÃ y

![](https://cdn-images-1.medium.com/max/1650/1*RXOmU_td5K-px7SsuhLOZw.png)

CÃ³ Ä‘oÃ¡n cÅ©ng tá»›i mai :))) nÃªn quay trá»Ÿ láº¡i source code cá»§a bÃ i nÃ y, thÃ¬ cÃ³ 1
Ä‘oáº¡n cáº§n chÃº Ã½

![](https://cdn-images-1.medium.com/max/1100/1*2LqDDwwh3qsxkDc8fxkfIg.png)

Náº¿u level = NULL (khÃ´ng cÃ³ 1 cookie nÃ o hoáº·c cookie khÃ´ng cÃ³ nghÄ©a) thÃ¬ level sáº½
Ä‘Æ°á»£c dá»±a vÃ o Ä‘oáº¡n code nÃ y, Ä‘Ã¢y lÃ  pháº§n code mÃ¬nh debug thá»­ Ä‘á»ƒ pass tá»›i level 13

> [https://repl.it/@Bui_Duc_AnhDuc/ShinyNeedyDesktopenvironment](https://repl.it/@Bui_Duc_AnhDuc/ShinyNeedyDesktopenvironment)

Váº¥n Ä‘á» lÃ  lÃ m sao Ä‘á»ƒ táº¡o ra 1 cookie mÃ  cÃ³ md5 hash cÃ³ thá»ƒ gá»­i lÃªn vÃ  cháº¡y tháº³ng
tá»›i level 13, Ä‘Ã¢y lÃ  váº¥n Ä‘á» cá»§a Hash Length Extension

CÃ¡c báº¡n cÃ³ thá»ƒ Ä‘á»c qua 2 wu cá»§a [PeterJson](https://medium.com/@peterjson) Ä‘á»ƒ
hiá»ƒu thÃªm vá» HLE, hoáº·c cÃ³ thá»ƒ cmt bÃªn dÆ°á»›i mÃ¬nh cÃ³ thá»ƒ giáº£i Ä‘Ã¡p nhá»¯ng cÃ¡i trong
giá»›i háº¡n kiáº¿n thá»©c mÃ¬nh há»c Ä‘Æ°á»£c qua Ä‘á»c 2 wu nÃ y:

[https://medium.com/@peterjson/matesctf-round-5-qualification-crypto-writeup-a5e287838e69](https://medium.com/@peterjson/matesctf-round-5-qualification-crypto-writeup-a5e287838e69)
**(ViettelStore â€” Crypto100)**

[https://medium.com/@peterjson/uit-hacking-contest-2018-crypto-writeup-8bf32267e93b](https://medium.com/@peterjson/uit-hacking-contest-2018-crypto-writeup-8bf32267e93b)
**(Crypto400-SuperSecureServer)**

MÃ¬nh dÃ¹ng Hash Extender Ä‘á»ƒ giáº£i quyáº¿t bÃ i nÃ y

![](https://cdn-images-1.medium.com/max/1650/1*UXt6CLKFXfu5NDYvs8VDDg.png)

Sau Ä‘Ã³ mÃ¬nh dÃ¹ng new signature Ä‘á»ƒ lÃ m cookie hash

new string thÃ¬ mÃ¬nh dÃ¹ng b64(â€˜seed=â€™+hexdecode(newstring)) Ä‘á»ƒ lÃ m cookie saved

![](https://cdn-images-1.medium.com/max/1650/1*ntTEUTpWW2FLFPbQNbbrxQ.png)

**3/ phplimit revenge**

![](https://cdn-images-1.medium.com/max/1650/1*i8ItcPPfDV41zunYNLGH3Q.png)

vá» cÃ¡c filter cá»§a bÃ i nÃ y thÃ¬ má»i ngÆ°á»i cÃ³ thá»ƒ dÃ¹ng
[https://regex101.com/](https://regex101.com/) Ä‘á»ƒ Ä‘á»c hiá»ƒu (ban Ä‘áº§u khÃ¡ lÃ  khÃ³
hiá»ƒu nhÆ°ng cÃ³ 1 sá»‘ trá»£ giÃºp tá»« ae báº¡n dÃ¬ nÃªn mÃ¬nh cÅ©ng hiá»ƒu ğŸ˜¤)

If 1 cháº·n khÃ´ng cho mÃ¬nh truyá»n argument (string) vÃ o cÃ¡c hÃ m Ä‘á»ƒ Ä‘á»c flag , nÃªn
chá»‰ cÃ³ thá»ƒ truyá»n boolean vÃ o Ä‘Ã¢y thÃ´i

If 2 thÃ¬ cháº·n 1 sá»‘ hÃ m dÃ¹ng Ä‘á»ƒ Ä‘á»c flag

[PeterJson](https://medium.com/@peterjson) láº¡i gá»£i Ã½ mÃ¬nh 1 hÃ m cÃ³ thá»ƒ show ra
Ä‘Æ°á»£c path hiá»‡n táº¡i + cÃ³ thá»ƒ truyá»n boolean argument vÃ o lÃ  realpath()

![](https://cdn-images-1.medium.com/max/1650/1*6pzag1vRG-Le78Ehw6jyZQ.png)

Cá»¥ thá»ƒ lÃ  mÃ¬nh cÃ³ thá»ƒ sá»­ dá»¥ng realpath(false) hoáº·c realpath(NULL)

mÃ  NULL thÃ¬ Ä‘Ã£ cÃ³ assert() => vá»›i realpath(assert()) thÃ¬ mÃ¬nh cÃ³ Ä‘Æ°á»£c path hiá»‡n
táº¡i

MÃ¬nh cáº§n Ä‘á»c nhá»¯ng file á»Ÿ path Ä‘Ã³ thÃ¬ cÃ³ scandir()

![](https://cdn-images-1.medium.com/max/1650/1*NWbG0E4ml-KE2zu28aRG8A.png)

vá»›i scandir(realpath(assert())) thÃ¬ mÃ¬nh cÃ³ Ä‘Æ°á»£c toÃ n bá»™ nhá»¯ng file á»Ÿ path Ä‘Ã³

scandir sáº½ tráº£ vá» array, mÃ¬nh chá»‰ biáº¿t má»—i hÃ m print_r() Ä‘á»ƒ in ra array nhÆ°ng bá»‹
filter máº¥t :((

![](https://cdn-images-1.medium.com/max/1650/1*N_5m1ZaLzM3LYX_qMSsIWQ.png)

Ok váº­y thÃ´i mÃ¬nh lÃ m thá»§ cÃ´ng

![](https://cdn-images-1.medium.com/max/1650/1*ln2xzpMxz4rQZOGhzmMCyA.png)

sau 1 há»“i mÃ² thÃ¬ tá»›i Ä‘Æ°á»£c path nÃ y

> [http://139.180.219.222/?code=echo(next(next(scandir(realpath(assert()))));](http://139.180.219.222/?code=echo(next(next(scandir(realpath(assert()))));)

LÃ  file index, nÃªn thÃ´i mÃ¬nh quyáº¿t Ä‘á»‹nh coi file cuá»‘i cÃ¹ng tÃªn gÃ¬ luÃ´n

> [http://139.180.219.222/?code=echo(end(scandir(realpath(assert()))));](http://139.180.219.222/?code=echo(end(scandir(realpath(assert()))));)

![](https://cdn-images-1.medium.com/max/1650/1*whTN8xiGeIgMG4wCJglS8A.png)

dÃ¹ng readfile() Ä‘á»ƒ Ä‘á»c file nÃ y

> view-source:[http://139.180.219.222/?code=readfile(end(scandir(realpath(assert()))));](http://139.180.219.222/?code=readfile(end(scandir(realpath(assert()))));)

![](https://cdn-images-1.medium.com/max/1650/1*9jcBoyXtI813TefGlJ99vg.png)

**4/ phplimit revenge v2**

Pháº£i nÃ³i lÃ  PHP khÃ¡ lÃ  áº£o diá»‡u khi mÃ¬nh lÃ m Ä‘c bÃ i nÃ y :3 mÃ¬nh ko hiá»ƒu tÃ¡c giáº£
cháº·n strlen rá»“i rand lÃ m gÃ¬ nhÆ°ng sau 1 thá»i gian Ä‘á»c cÃ¡c hÃ m trÃªn w3schools thÃ¬
tháº¥y cÃ³ 4 hÃ m lÃ  `dirname, basename, realpath, pathinfo` thÃ¬ Ä‘á»u bá»‹ blacklisted
theo nhÆ° web nÃ y nÃ³i

search Ä‘i search láº¡i cÅ©ng tháº¥y web nÃ o nÃ³i lÃ  dÃ¹ng `glob()` kÃ¨m vs pattern

Ä‘áº¯n Ä‘o mÃ£i thÃ¬ thá»­ vs php online thÃ¬ mÃ¬nh tháº¥y lÃ  glob() tráº£ vá» array theo
pattern *, má»—i pháº§n tá»­ lÃ  cÃ¡c file trong thÆ° má»¥c ğŸ˜†

![](https://cdn-images-1.medium.com/max/1100/1*Xnoq-uU3vDDIyvHIfpHfSQ.png)

`'*'` thÃ¬ nÃ³ lÃ  string, lÃ m sao Ä‘á»ƒ táº¡o *? booom, 1 idea khÃ¡ lÃ  xá»‹n cÅ©ng láº§y vc,
lÃ  tÃ­nh ra sá»‘ 42 r chr() Ä‘á»ƒ thÃ nh *

báº¯t Ä‘áº§u Ä‘i tá»« `exp(assert())` , lÃ½ do mÃ¬nh gá»i `assert()` vÃ¬ nÃ³ lÃ  máº·c Ä‘á»‹nh lÃ 
TRUE == 1, thá»±c hiá»‡n cÃ¡c phÃ©p tÃ­nh toÃ¡n (lÃ m Ä‘áº¡i) thÃ¬ may tháº­t ra dc sá»‘ 42 ğŸ˜–

![](https://cdn-images-1.medium.com/max/1100/1*iDVFcxF0fQ6ojhIQBrq79A.png)

mÃ¬nh cÅ©ng ko hiá»ƒu táº¡i sao local tÃ­nh ra sá»‘ khÃ¡c server tÃ­nh sá»‘ khÃ¡c

dc 42 r thÃ¬ biáº¿n nÃ³ thÃ nh * vÃ  glob :3

![](https://cdn-images-1.medium.com/max/1100/1*e6gAyAFIawcaK6hXbsCgqQ.png)

nhÆ° trÃªn glob tráº£ vá» array, nhÆ°ng trÆ°á»›c tiÃªn coi thá»­ cÃ³ bn file hay folder con
trong folder nÃ y (/var/www/html/)

![](https://cdn-images-1.medium.com/max/1100/1*u7l5gw7KAZGfwtynI7RvOA.png)

hÃªn vl :))) lÃ  cÃ³ 3 file (ko biáº¿t cÃ³ folder hay ko). Tiá»‡n vl, mÃ¬nh dÃ¹ng [cÃ¡c hÃ m
nÃ y Ä‘á»ƒ di chuyá»ƒn con trá» tá»›i cÃ¡c element trong
array](https://www.w3schools.com/php/func_array_current.asp). HÃªn lÃ  vÃ¬ tÃ¡c giáº£
Ä‘á»ƒ chá»‰ cÃ³ 3 file, chá»© 4 files mÃ  flag náº±m á»Ÿ vá»‹ trÃ­ thá»© 3 mÃ¬nh cÅ©ng cháº£ biáº¿t trá»
kiá»ƒu gÃ¬ =))

Ä‘oÃ¡n bá»«a flag náº±m cuá»‘i nÃªn mÃ¬nh dÃ¹ng end(â€¦)

![](https://cdn-images-1.medium.com/max/1100/1*goajIB-qLCPVhRoMiCtlXA.png)

Coi thá»­ cÃ³ cÃ¡i gÃ¬ trong nÃ y

![](https://cdn-images-1.medium.com/max/1100/1*uHpSr8WUFS22UoOCz730FQ.png)

:)))) classic trick tá»« a tsu, ok má»i chuyá»‡n tá»« giá» cÃ²n khÃ³ hÆ¡n

okay, mÃ¬nh cáº§n bÃ¢y giá» lÃ  `..` Ä‘á»ƒ cÃ³ thá»ƒ view cÃ¡c file trong parrent folder

ok, got it, ko dÃ¹ng `glob()`ná»¯a mÃ  mÃ¬nh sáº½ dÃ¹ng `scandir('.')`thay cho glob() vÃ¬
nhÆ° hÃ¬nh bÃªn trÃªn `glob('*')` ko return vá» `. hoáº·c ..`

![](https://cdn-images-1.medium.com/max/1100/1*eHiLko1bw6m7zK9b1Pq4sQ.png)

Hay quÃ¡ cÃ³ rá»“i :))) bÃ¢y giá» lÃ  cÃ´ng Ä‘oáº¡n lÃ m cÃ¡ch nÃ o tÃ­nh cho ra Ä‘Æ°á»£c sá»‘ 46
(decimal cá»§a .)

Báº±ng cÃ¡c biá»‡n phÃ¡p nghiá»‡p vá»¥ káº¿t há»£p vs kÄ© nÄƒng toÃ¡n há»c mÃ  mÃ¬nh cÃ³ vá»›i 1 Ã­t tÃ¢m
linh nÃ o Ä‘Ã³ Ä‘Ã£ cho mÃ¬nh sá»©c máº¡nh tÃ­nh ra dc 64 =))) thá»­ xem sao

![](https://cdn-images-1.medium.com/max/1100/1*tCQUMRwJd8goGM0K7MIo-w.png)

cÃ³ . rá»“i thÃ¬ scandir hiá»‡n táº¡i lÃ  (.) láº¥y next() lÃ  (..), rá»“i scandir(..), láº¥y
end lÃ  cÃ³ real flag

![](https://cdn-images-1.medium.com/max/1100/1*812TPBtoFtRbN36owWJkDw.png)

![](https://cdn-images-1.medium.com/max/1100/1*jMoo33DJBg9VljZcJkUSuw.png)

MÃ  flag cá»§a mÃ¬nh Ä‘Ã¢u rá»“i

Suy nghÄ© 1 chÃºt thÃ¬ mÃ¬nh nÃ³ chá»‰ show content cá»§a parent dir thÃ´i chá»© mÃ¬nh chÆ°a á»Ÿ
parent dir

dÃ¹ng chdir() thÃ¬ cháº¯c Ä‘Æ°á»£c vÃ¬ mÃ¬nh Ä‘Ã£ cÃ³ `..` rá»“i nÃªn nhÆ°ng lÃ m sao Ä‘á»c flag?

![](https://cdn-images-1.medium.com/max/1100/1*xDuxfkcofnb3_hs55F6yDA.png)

tháº¿ lá»±c siÃªu nhiÃªn nÃ o Ä‘Ã³ láº¡i giÃºp mÃ¬nh khi chdir() return vá» boolean vÃ  nÃ³ lÃ 
`true == 1` . ThÃ¬ sao nhá»‰ :3 nghÄ©a lÃ  mÃ¬nh Ä‘ang cÃ³ máº·t á»Ÿ `..` vÃ  chá»‰ cáº§n dÃ¹ng
phÃ©p toÃ¡n mÃ  tháº§n linh Ä‘Ã£ ban cho tÃ­nh tá»« exp(assert()) == chdir(â€˜..â€™)

![](https://cdn-images-1.medium.com/max/1100/1*5X8ukW4HbaxF7R5gIT8BnA.png)

http://45.76.181.81/?code=readfile(end(scandir(chr(strrev(floor(rad2deg(tan(sin(round(chdir(next(scandir(chr(strrev(floor(rad2deg(tan(sin(round(exp(assert())))))))))))))))))))));
